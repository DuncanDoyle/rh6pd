<html>
<head>
	<script type = "text/javascript" src = "resources/javascript/jquery.js"></script>
	<link rel = "stylesheet" type = "text/css" href = "resources/stylesheets/6pdstyle.css" />
	<title>Tasks</title>   
</head>
<body>  

<div style = "text-align: center">  
	<iframe style = "width: 700px; height: 850px; border: 0;" src = "#"></iframe>
</div>
  
<script type = "text/javascript">
 
$("iframe").on("load", function (event) {
	var url = event.target.contentDocument.URL;
 
	console.log("iFrame has loaded URL: " + url); 
		
	if (url.indexOf('render') != -1) {  
		//$('h1').text("Please complete this task");   
	} else if (url.indexOf('complete') != -1) {  
		//$('h1').text("Completed task, finding next action"); 
		document.location.reload(true);
	} else {  
		alert("JBoss 6PD Error: Insurance Demo tasks.html: this is not a task"); 
	}    
    
})

</script>

<script>
var url="http://localhost:8080/business-central-server/rs/tasks/admin/participation";
var data = {}

var http_request = new XMLHttpRequest();
http_request.open("GET", url, true);
http_request.onreadystatechange = function () {
    var done = 4, ok = 200;
    ifrm = $('iframe');
    
    if (http_request.readyState == done && http_request.status == ok) 
    {
        var data = JSON.parse(http_request.response);

        console.log(data); 

        if (data.tasks.length == 0) 
        {
	        ifrm.hide();   
	        console.log("Process complete", data);
            window.location = "complete.html";
        } 
        else 
        { 
	        var output="<ul>";
	       
	        for (var i in data.tasks)
	        {
	            output+="<li>" + "ID= " + data.tasks[i].processInstanceId + "   " + data.tasks[i].url + "</li>";
	        }
	        output+="</ul>";
	 
	        ifrm.attr("src", data.tasks[i].url);
        }
    }
}
http_request.send(null);
</script>
</body>
</html>
